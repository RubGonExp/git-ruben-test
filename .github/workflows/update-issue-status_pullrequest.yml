name: Merge Comment
on:
  pull_request:
    types: [closed, synchronize]
    # branches: [develop]
jobs:
  merge-comment:
    permissions: write-all
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Create Comment
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            BODY_TEXT: ${{ github.event.pull_request.body }}
        run: |
          urls=$(echo "$BODY_TEXT" | grep -oP '(?<=\().*?(?=\))')
          for url in $urls; do
            echo "URL: $url"
            api_url=api_url=$(echo "$url" | sed 's#https://github.com/#https://api.github.com/repos/#')
            echo "API URL: $api_url"
            issue_number=$(echo "$url" | grep -oP '(?<=/issues/)\d+')
            echo "Issue Number: $issue_number"
            comment_body="Este es un comentario de ejemplo para el issue #${issue_number}"
            echo "Comment Body: $comment_body"
            curl -X POST -H "Authorization: Bearer $GITHUB_TOKEN" -d "{\"body\":\"$comment_body\"}" "$api_url/comments"
            echo "$api_url/comments"
          done